"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.prv2bigint = prv2bigint;
exports.prv2pub = prv2pub;
exports.signWithHasher = signWithHasher;
exports.verifyWithHasher = verifyWithHasher;
exports.packSignature = packSignature;
exports.unpackSignature = unpackSignature;
exports.pruneBuffer = pruneBuffer;

var _blakeHash = _interopRequireDefault(require("blake-hash"));

var _ffjs = require("./ffjs");

var _circomlib = require("circomlib");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function pruneBuffer(_buff) {
  var buff = Buffer.from(_buff);
  buff[0] = buff[0] & 0xf8;
  buff[31] = buff[31] & 0x7f;
  buff[31] = buff[31] | 0x40;
  return buff;
}

function prv2bigint(prv) {
  var sBuff = pruneBuffer((0, _blakeHash["default"])('blake512').update(prv).digest().slice(0, 32));

  var s = _ffjs.ffutils.leBuff2int(sBuff);

  return _ffjs.Scalar.shr(s, 3);
}

function prv2pub(prv) {
  var A = _circomlib.babyJub.mulPointEscalar(_circomlib.babyJub.Base8, prv2bigint(prv));

  return A;
}

function signWithHasher(prv, msg, hasher) {
  var h1 = (0, _blakeHash["default"])('blake512').update(prv).digest();
  var sBuff = pruneBuffer(h1.slice(0, 32));

  var s = _ffjs.ffutils.leBuff2int(sBuff);

  var A = _circomlib.babyJub.mulPointEscalar(_circomlib.babyJub.Base8, _ffjs.Scalar.shr(s, 3));

  var msgBuff = _ffjs.ffutils.leInt2Buff(msg, 32);

  var rBuff = (0, _blakeHash["default"])('blake512').update(Buffer.concat([h1.slice(32, 64), msgBuff])).digest();

  var r = _ffjs.ffutils.leBuff2int(rBuff);

  var Fr = new _ffjs.F1Field(_circomlib.babyJub.subOrder);
  r = Fr.e(r);

  var R8 = _circomlib.babyJub.mulPointEscalar(_circomlib.babyJub.Base8, r);

  var hm = hasher([R8[0], R8[1], A[0], A[1], msg]);
  var S = Fr.add(r, Fr.mul(hm, s));
  return {
    R8: R8,
    S: S
  };
}

function verifyWithHasher(msg, sig, A, hasher) {
  // Check parameters
  if (_typeof(sig) != 'object') return false;
  if (!Array.isArray(sig.R8)) return false;
  if (sig.R8.length != 2) return false;
  if (!_circomlib.babyJub.inCurve(sig.R8)) return false;
  if (!Array.isArray(A)) return false;
  if (A.length != 2) return false;
  if (!_circomlib.babyJub.inCurve(A)) return false;
  if (sig.S >= _circomlib.babyJub.subOrder) return false;
  var hm = hasher([sig.R8[0], sig.R8[1], A[0], A[1], msg]);

  var Pleft = _circomlib.babyJub.mulPointEscalar(_circomlib.babyJub.Base8, sig.S);

  var Pright = _circomlib.babyJub.mulPointEscalar(A, _ffjs.Scalar.mul(hm, 8));

  Pright = _circomlib.babyJub.addPoint(sig.R8, Pright);
  if (!_circomlib.babyJub.F.eq(Pleft[0], Pright[0])) return false;
  if (!_circomlib.babyJub.F.eq(Pleft[1], Pright[1])) return false;
  return true;
}

function packSignature(sig) {
  var R8p = _circomlib.babyJub.packPoint(sig.R8);

  var Sp = _ffjs.ffutils.leInt2Buff(sig.S, 32);

  return Buffer.concat([R8p, Sp]);
}

function unpackSignature(sigBuff) {
  return {
    R8: _circomlib.babyJub.unpackPoint(sigBuff.slice(0, 32)),
    S: _ffjs.ffutils.leBuff2int(sigBuff.slice(32, 64))
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lZGRzYS50cyJdLCJuYW1lcyI6WyJwcnVuZUJ1ZmZlciIsIl9idWZmIiwiYnVmZiIsIkJ1ZmZlciIsImZyb20iLCJwcnYyYmlnaW50IiwicHJ2Iiwic0J1ZmYiLCJ1cGRhdGUiLCJkaWdlc3QiLCJzbGljZSIsInMiLCJmZnV0aWxzIiwibGVCdWZmMmludCIsIlNjYWxhciIsInNociIsInBydjJwdWIiLCJBIiwiYmFieUp1YiIsIm11bFBvaW50RXNjYWxhciIsIkJhc2U4Iiwic2lnbldpdGhIYXNoZXIiLCJtc2ciLCJoYXNoZXIiLCJoMSIsIm1zZ0J1ZmYiLCJsZUludDJCdWZmIiwickJ1ZmYiLCJjb25jYXQiLCJyIiwiRnIiLCJGMUZpZWxkIiwic3ViT3JkZXIiLCJlIiwiUjgiLCJobSIsIlMiLCJhZGQiLCJtdWwiLCJ2ZXJpZnlXaXRoSGFzaGVyIiwic2lnIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwiaW5DdXJ2ZSIsIlBsZWZ0IiwiUHJpZ2h0IiwiYWRkUG9pbnQiLCJGIiwiZXEiLCJwYWNrU2lnbmF0dXJlIiwiUjhwIiwicGFja1BvaW50IiwiU3AiLCJ1bnBhY2tTaWduYXR1cmUiLCJzaWdCdWZmIiwidW5wYWNrUG9pbnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFFQTs7QUFDQTs7QUFDQTs7Ozs7O0FBRUEsU0FBU0EsV0FBVCxDQUFxQkMsS0FBckIsRUFBNEI7QUFDMUIsTUFBTUMsSUFBSSxHQUFHQyxNQUFNLENBQUNDLElBQVAsQ0FBWUgsS0FBWixDQUFiO0FBQ0FDLEVBQUFBLElBQUksQ0FBQyxDQUFELENBQUosR0FBVUEsSUFBSSxDQUFDLENBQUQsQ0FBSixHQUFVLElBQXBCO0FBQ0FBLEVBQUFBLElBQUksQ0FBQyxFQUFELENBQUosR0FBV0EsSUFBSSxDQUFDLEVBQUQsQ0FBSixHQUFXLElBQXRCO0FBQ0FBLEVBQUFBLElBQUksQ0FBQyxFQUFELENBQUosR0FBV0EsSUFBSSxDQUFDLEVBQUQsQ0FBSixHQUFXLElB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QUFUO0FBRUEsTUFBSSxDQUFDNUIsbUJBQVE4QixDQUFSLENBQVVDLEVBQVYsQ0FBYUosS0FBSyxDQUFDLENBQUQsQ0FBbEIsRUFBdUJDLE1BQU0sQ0FBQyxDQUFELENBQTdCLENBQUwsRUFBd0MsT0FBTyxLQUFQO0FBQ3hDLE1BQUksQ0FBQzVCLG1CQUFROEIsQ0FBUixDQUFVQyxFQUFWLENBQWFKLEtBQUssQ0FBQyxDQUFELENBQWxCLEVBQXVCQyxNQUFNLENBQUMsQ0FBRCxDQUE3QixDQUFMLEVBQXdDLE9BQU8sS0FBUDtBQUN4QyxTQUFPLElBQVA7QUFDRDs7QUFFRCxTQUFTSSxhQUFULENBQXVCVixHQUF2QixFQUE0QjtBQUMxQixNQUFNVyxHQUFHLEdBQUdqQyxtQkFBUWtDLFNBQVIsQ0FBa0JaLEdBQUcsQ0FBQ04sRUFBdEIsQ0FBWjs7QUFDQSxNQUFNbUIsRUFBRSxHQUFHekMsY0FBUWMsVUFBUixDQUFtQmMsR0FBRyxDQUFDSixDQUF2QixFQUEwQixFQUExQixDQUFYOztBQUNBLFNBQU9qQyxNQUFNLENBQUN5QixNQUFQLENBQWMsQ0FBQ3VCLEdBQUQsRUFBTUUsRUFBTixDQUFkLENBQVA7QUFDRDs7QUFFRCxTQUFTQyxlQUFULENBQXlCQyxPQUF6QixFQUFrQztBQUNoQyxTQUFPO0FBQ0xyQixJQUFBQSxFQUFFLEVBQUVoQixtQkFBUXNDLFdBQVIsQ0FBb0JELE9BQU8sQ0FBQzdDLEtBQVIsQ0FBYyxDQUFkLEVBQWlCLEVBQWpCLENBQXBCLENBREM7QUFFTDBCLElBQUFBLENBQUMsRUFBRXhCLGNBQVFDLFVBQVIsQ0FBbUIwQyxPQUFPLENBQUM3QyxLQUFSLENBQWMsRUFBZCxFQUFrQixFQUFsQixDQUFuQjtBQUZFLEdBQVA7QUFJRCIsInNvdXJjZXNDb250ZW50IjpbIi8qIG1vZGlmaWVkIGZyb20gY2lyY29tbGliL3NyYy9lZGRzYS5qcyAqL1xuXG5pbXBvcnQgY3JlYXRlQmxha2VIYXNoIGZyb20gJ2JsYWtlLWhhc2gnO1xuaW1wb3J0IHsgU2NhbGFyLCBGMUZpZWxkLCBmZnV0aWxzIH0gZnJvbSAnLi9mZmpzJztcbmltcG9ydCB7IGJhYnlKdWIsIHBvc2VpZG9uIH0gZnJvbSAnY2lyY29tbGliJztcblxuZnVuY3Rpb24gcHJ1bmVCdWZmZXIoX2J1ZmYpIHtcbiAgY29uc3QgYnVmZiA9IEJ1ZmZlci5mcm9tKF9idWZmKTtcbiAgYnVmZlswXSA9IGJ1ZmZbMF0gJiAweGY4O1xuICBidWZmWzMxXSA9IGJ1ZmZbMzFdICYgMHg3ZjtcbiAgYnVmZlszMV0gPSBidWZmWzMxXSB8IDB4NDA7XG4gIHJldHVybiBidWZmO1xufVxuXG5mdW5jdGlvbiBwcnYyYmlnaW50KHBydikge1xuICBjb25zdCBzQnVmZiA9IHBydW5lQnVmZmVyKGNyZWF0ZUJsYWtlSGFzaCgnYmxha2U1MTInKS51cGRhdGUocHJ2KS5kaWdlc3QoKS5zbGljZSgwLCAzMikpO1xuICBsZXQgcyA9IGZmdXRpbHMubGVCdWZmMmludChzQnVmZik7XG4gIHJldHVybiBTY2FsYXIuc2hyKHMsIDMpO1xufVxuXG5mdW5jdGlvbiBwcnYycHViKHBydikge1xuICBjb25zdCBBID0gYmFieUp1Yi5tdWxQb2ludEVzY2FsYXIoYmFieUp1Yi5CYXNlOCwgcHJ2MmJpZ2ludChwcnYpKTtcbiAgcmV0dXJuIEE7XG59XG5cbmZ1bmN0aW9uIHNpZ25XaXRoSGFzaGVyKHBydiwgbXNnLCBoYXNoZXIpIHtcbiAgY29uc3QgaDEgPSBjcmVhdGVCbGFrZUhhc2goJ2JsYWtlNTEyJykudXBkYXRlKHBydikuZGlnZXN0KCk7XG4gIGNvbnN0IHNCdWZmID0gcHJ1bmVCdWZmZXIoaDEuc2xpY2UoMCwgMzIpKTtcbiAgY29uc3QgcyA9IGZmdXRpbHMubGVCdWZmMmludChzQnVmZik7XG4gIGNvbnN0IEEgPSBiYWJ5SnViLm11bFBvaW50RXNjYWxhcihiYWJ5SnViLkJhc2U4LCBTY2FsYXIuc2hyKHMsIDMpKTtcblxuICBjb25zdCBtc2dCdWZmID0gZmZ1dGlscy5sZUludDJCdWZmKG1zZywgMzIpO1xuICBjb25zdCByQnVmZiA9IGNyZWF0ZUJsYWtlSGFzaCgnYmxha2U1MTInKVxuICAgIC51cGRhdGUoQnVmZmVyLmNvbmNhdChbaDEuc2xpY2UoMzIsIDY0KSwgbXNnQnVmZl0pKVxuICAgIC5kaWdlc3QoKTtcbiAgbGV0IHIgPSBmZnV0aWxzLmxlQnVmZjJpbnQockJ1ZmYpO1xuICBjb25zdCBGciA9IG5ldyBGMUZpZWxkKGJhYnlKdWIuc3ViT3JkZXIpO1xuICByID0gRnIuZShyKTtcbiAgY29uc3QgUjggPSBiYWJ5SnViLm11bFBvaW50RXNjYWxhcihiYWJ5SnViLkJhc2U4LCByKTtcbiAgY29uc3QgaG0gPSBoYXNoZXIoW1I4WzBdLCBSOFsxXSwgQVswXSwgQVsxXSwgbXNnXSk7XG4gIGNvbnN0IFMgPSBGci5hZGQociwgRnIubXVsKGhtLCBzKSk7XG4gIHJldHVybiB7XG4gICAgUjg6IFI4LFxuICAgIFM6IFMsXG4gIH07XG59XG5cbmZ1bmN0aW9uIHZlcmlmeVdpdGhIYXNoZXIobXNnLCBzaWcsIEEsIGhhc2hlcikge1xuICAvLyBDaGVjayBwYXJhbWV0ZXJzXG4gIGlmICh0eXBlb2Ygc2lnICE9ICdvYmplY3QnKSByZXR1cm4gZmFsc2U7XG4gIGlmICghQXJyYXkuaXNBcnJheShzaWcuUjgpKSByZXR1cm4gZmFsc2U7XG4gIGlmIChzaWcuUjgubGVuZ3RoICE9IDIpIHJldHVybiBmYWxzZTtcbiAgaWYgKCFiYWJ5SnViLmluQ3VydmUoc2lnLlI4KSkgcmV0dXJuIGZhbHNlO1xuICBpZiAoIUFycmF5LmlzQXJyYXkoQSkpIHJldHVybiBmYWxzZTtcbiAgaWYgKEEubGVuZ3RoICE9IDIpIHJldHVybiBmYWxzZTtcbiAgaWYgKCFiYWJ5SnViLmluQ3VydmUoQSkpIHJldHVybiBmYWxzZTtcbiAgaWYgKHNpZy5TID49IGJhYnlKdWIuc3ViT3JkZXIpIHJldHVybiBmYWxzZTtcblxuICBjb25zdCBobSA9IGhhc2hlcihbc2lnLlI4WzBdLCBzaWcuUjhbMV0sIEFbMF0sIEFbMV0sIG1zZ10pO1xuXG4gIGNvbnN0IFBsZWZ0ID0gYmFieUp1Yi5tdWxQb2ludEVzY2FsYXIoYmFieUp1Yi5CYXNlOCwgc2lnLlMpO1xuICBsZXQgUHJpZ2h0ID0gYmFieUp1Yi5tdWxQb2ludEVzY2FsYXIoQSwgU2NhbGFyLm11bChobSwgOCkpO1xuICBQcmlnaHQgPSBiYWJ5SnViLmFkZFBvaW50KHNpZy5SOCwgUHJpZ2h0KTtcblxuICBpZiAoIWJhYnlKdWIuRi5lcShQbGVmdFswXSwgUHJpZ2h0WzBdKSkgcmV0dXJuIGZhbHNlO1xuICBpZiAoIWJhYnlKdWIuRi5lcShQbGVmdFsxXSwgUHJpZ2h0WzFdKSkgcmV0dXJuIGZhbHNlO1xuICByZXR1cm4gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gcGFja1NpZ25hdHVyZShzaWcpIHtcbiAgY29uc3QgUjhwID0gYmFieUp1Yi5wYWNrUG9pbnQoc2lnLlI4KTtcbiAgY29uc3QgU3AgPSBmZnV0aWxzLmxlSW50MkJ1ZmYoc2lnLlMsIDMyKTtcbiAgcmV0dXJuIEJ1ZmZlci5jb25jYXQoW1I4cCwgU3BdKTtcbn1cblxuZnVuY3Rpb24gdW5wYWNrU2lnbmF0dXJlKHNpZ0J1ZmYpIHtcbiAgcmV0dXJuIHtcbiAgICBSODogYmFieUp1Yi51bnBhY2tQb2ludChzaWdCdWZmLnNsaWNlKDAsIDMyKSksXG4gICAgUzogZmZ1dGlscy5sZUJ1ZmYyaW50KHNpZ0J1ZmYuc2xpY2UoMzIsIDY0KSksXG4gIH07XG59XG5cbmV4cG9ydCB7IHBydjJiaWdpbnQsIHBydjJwdWIsIHNpZ25XaXRoSGFzaGVyLCB2ZXJpZnlXaXRoSGFzaGVyLCBwYWNrU2lnbmF0dXJlLCB1bnBhY2tTaWduYXR1cmUsIHBydW5lQnVmZmVyIH07XG4iXX0=